[Unit]
Description=Cockroach Database cluster node
Requires=network.target

[Service]
Type=notify
WorkingDirectory=/var/lib/cockroach
ExecStart=/usr/local/bin/cockroach start --certs-dir=certs --advertise-addr=<node1 address> --join=<node1 address>,<node2 address>,<node3 address> --cache=.25 --max-sql-memory=.25
ExecStart=/usr/local/bin/cockroach start --insecure {% if (crdb_ptp | bool) %}--clock-device={{ crdb_ptp_dev }} {% endif %}{% for item in crdb_data_disks %}--store={{ item }} {% endfor %}--listen-addr=%H --join={{ bootstrap | join(',') }} {% if (advertise_ip | default(crdb_advertise_addr)) %}--advertise-addr={{ inventory_hostname }}{% endif %} --cache=.25 --max-sql-memory=.25 --locality=rack={{groups['all'].index(inventory_hostname) % (crdb_rack_count | default(1)) }}
TimeoutStopSec=300
Restart=always
RestartSec=10
StandardOutput=syslog
StandardError=syslog
SyslogIdentifier=cockroach
User=cockroach

[Install]
WantedBy=default.target